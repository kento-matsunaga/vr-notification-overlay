# VRNotify - VR Notification Overlay

Windows の通知を VR 空間内にリアルタイムで表示するオーバーレイアプリケーションです。

SteamVR 対応の VR ヘッドセットで、Discord / LINE / Slack / Teams など、あらゆる Windows アプリの通知を **VR を外さずに** 確認できます。

---

## 特徴

- **Windows 通知キャプチャ** - あらゆる Windows アプリの通知を自動取得（設定やトークン不要）
- **VR オーバーレイ表示** - SteamVR オーバーレイとして HMD 上部に通知カードを表示
- **アプリフィルタ** - アプリ名で通知の表示/非表示を制御（許可リスト・除外リスト両対応）
- **おやすみモード（DND）** - 全抑制 / 高優先度のみ / オフ を切り替え
- **表示カスタマイズ** - 表示秒数、不透明度、スケールを調整可能
- **通知履歴** - 過去の通知を設定画面から確認・削除可能（SQLite、最大1000件/7日間保持）
- **システムトレイ常駐** - バックグラウンドで動作、トレイアイコンからアクセス
- **SteamVR 自動検出** - SteamVR の起動/終了を自動検出し、オーバーレイを自動で有効化/無効化

---

## 動作環境

| 項目 | 要件 |
|------|------|
| **OS** | Windows 10 (Build 19041 以上) / Windows 11 |
| **VR** | SteamVR 対応ヘッドセット |
| **ランタイム** | .NET 8 同梱（別途インストール不要） |

### 動作確認済みヘッドセット

- Meta Quest 2 / 3 / Pro（Air Link / Quest Link 経由の PCVR）
- Valve Index
- HTC VIVE / VIVE Pro

> SteamVR に対応している PCVR ヘッドセットであれば基本的に動作します。
> スタンドアロンモード（PC未接続）では動作しません。

---

## インストール

### インストーラー版（推奨）

1. `VRNotify-1.0.0-Installer.exe` をダブルクリック
2. Windows の管理者権限の確認ダイアログで **「はい」** を選択
3. インストール先を確認して **「Install」** をクリック
4. インストールが完了するまで待つ

インストーラーが自動で以下を行います：
- ファイルを `C:\Program Files\VRNotify\` にコピー
- 自己署名証明書の作成と登録
- Sparse MSIX パッケージの登録（Windows 通知アクセスに必要）
- スタートメニューにショートカットを追加
- 「設定 → アプリ」にアンインストール情報を登録

> **SmartScreen の警告について**: 自己署名証明書を使用しているため、初回実行時に
> 「WindowsによってPCが保護されました」と表示される場合があります。
> 「詳細情報」→「実行」で続行してください。

### ポータブル版（ZIP）

1. `VRNotify-1.0.0-Portable.zip` を任意のフォルダに展開
2. **管理者権限** の PowerShell を開く
   - スタートメニューで「PowerShell」を検索 → 右クリック →「管理者として実行」
3. 展開したフォルダに移動して、セットアップスクリプトを実行:
   ```powershell
   cd "C:\展開先のパス\VRNotify"
   .\setup-portable.ps1
   ```
4. セットアップが完了したら、スタートメニューから **VRNotify** を起動

> **重要**: ポータブル版でも初回セットアップ（証明書 + Sparse MSIX 登録）が必要です。
> `VRNotify.Desktop.exe` を直接ダブルクリックしても、Package Identity がないため
> Windows 通知のキャプチャが動作しません。必ず `setup-portable.ps1` を実行してください。

---

## 使い方

### 起動

1. スタートメニューから **VRNotify** を起動
2. タスクバー右下の通知領域（システムトレイ）に **青い「VR」アイコン** が表示されます
3. VRNotify はバックグラウンドで動作し、Windows 通知のキャプチャを開始します

### SteamVR との連携

- VRNotify は **5秒間隔** で SteamVR の起動を自動検出します
- SteamVR が起動するとオーバーレイが自動的に有効になります
- SteamVR が終了してもVRNotifyは動作を継続し、再起動を待ちます
- **起動順序は自由です**（VRNotify → SteamVR でも、SteamVR → VRNotify でも動作します）

### VR 内での通知表示

Windows 通知が発生すると、**VR 空間内に通知カードが表示** されます。

#### 通知カードの見え方

```
┌─────────────────────────────────────────────┐
│ ┃ アプリ名          通知タイトル             │
│ ┃ 通知の本文テキスト...                      │
└─────────────────────────────────────────────┘
```

- **表示位置**: HMD（ヘッドマウントディスプレイ）の**やや上方**、正面方向
  - 頭を動かすと通知も一緒に動きます（HMD 追従型）
  - 視野の中央上部に表示されるため、ゲームプレイの邪魔になりにくい配置です
- **カードサイズ**: 横幅 約30cm（VR空間内）
- **デザイン**: 暗いグレーの背景に角丸デザイン、左側に青い縦線（Windows通知の識別色）
- **テキスト**: 白い送信元アプリ名、グレーの通知タイトル、ライトグレーの本文
- **表示時間**: デフォルト **5秒** で自動的に消えます（設定で 2〜15秒に変更可能）
- **同時表示**: 最大 **3件** まで同時に表示されます
- 4件目以降はキューに蓄積され、表示中のカードが消えると順次表示されます

#### 通知の流れ

```
Windows アプリが通知を送信
    ↓
VRNotify が通知をキャプチャ
    ↓
アプリフィルタで評価（設定に従い許可/遮断）
    ↓
DND モードを確認
    ↓
通知履歴（SQLite）に記録
    ↓
VR オーバーレイに表示（SteamVR 起動中のみ）
    ↓
設定した秒数後に自動消去
```

> **SteamVR が起動していない場合**: 通知はキャプチャされ履歴に記録されますが、
> VR オーバーレイへの表示はスキップされます。

---

## 設定画面

トレイアイコンを **ダブルクリック** するか、**右クリック → 「Settings...」** で設定画面を開きます。

### General（一般）タブ

**おやすみモード（DND）** を設定します。

| モード | 動作 |
|--------|------|
| **Off** (デフォルト) | すべての通知を VR に表示する |
| **Suppress All** | すべての通知を非表示にする（履歴には記録される） |
| **High Priority Only** | 高優先度の通知のみ表示する |

> **補足**: 現在のバージョンでは Windows 通知はすべて「低優先度」として扱われるため、
> 「High Priority Only」を選択するとすべての通知が非表示になります。
> 将来の Discord Bot 連携時に、DM やメンションが高優先度として分類される予定です。

### Filter（フィルタ）タブ

アプリ名で通知の表示/非表示を制御します。

#### フィルタモード

| モード | 説明 |
|--------|------|
| **Allow all (blocklist mode)** (デフォルト) | 基本全て許可。指定したアプリだけブロック |
| **Block all (allowlist mode)** | 基本全てブロック。指定したアプリだけ許可 |

#### アプリリスト

- 通知を受信すると、そのアプリ名が **自動的にリストに追加** されます
- 手動でアプリ名を入力する必要はありません
- 各アプリの横にある **ボタン** をクリックして「Allowed」/「Blocked」を切り替えます

**使い方の例**:
- 「Discord と LINE の通知だけ VR に表示したい」
  → Block all (allowlist mode) に切り替え → Discord と LINE を Allowed に設定
- 「Microsoft Store の通知だけ止めたい」
  → Allow all (blocklist mode) のまま → Microsoft Store を Blocked に設定

> アプリ名の判定は **大文字小文字を区別しません**（Discord = discord = DISCORD）。

### Display（表示）タブ

VR 内の通知カードの表示設定を調整します。

| 設定項目 | 範囲 | デフォルト | 説明 |
|----------|------|-----------|------|
| **Position** | HmdTop 等 | HmdTop | 通知の表示位置 |
| **Display Duration** | 2〜15秒 | 5秒 | 通知が表示される時間 |
| **Opacity** | 10〜100% | 100% | 通知カードの不透明度 |
| **Scale** | 50〜200% | 100% | 通知カードの大きさ |

> **表示位置について**: 現在のバージョンでは **HmdTop**（HMD上部）のみ対応しています。
> 他の位置（HmdBottom、LeftWrist 等）は将来のアップデートで対応予定です。

**おすすめ設定**:
- 通知が邪魔に感じる場合 → 表示秒数を短く（2〜3秒）、不透明度を下げる（60〜80%）
- 通知を見逃したくない場合 → 表示秒数を長く（10〜15秒）、不透明度を100%

### History（履歴）タブ

過去に受信した通知の履歴を確認できます。

- **表示内容**: 受信時刻（HH:mm）、アプリ名、送信者、メッセージ本文
- **表示件数**: 最新 100件
- **保持期間**: 7日間（設定画面右下に表示）
- **上限件数**: 1000件
- 7日間または1000件を超えた古い通知は自動的に削除されます

**「Clear History」ボタン**: クリックすると通知履歴をすべて削除します。

### About タブ

VRNotify のバージョン情報を表示します。

---

## トレイメニュー

システムトレイの VRNotify アイコンを **右クリック** すると、以下のメニューが表示されます。

| メニュー項目 | 説明 |
|-------------|------|
| **Settings...** | 設定画面を開く |
| **DND Mode →** | おやすみモードの切り替え（Off / Suppress All / High Priority Only） |
| **Exit** | VRNotify を終了する |

> **DND モードの素早い切り替え**: 設定画面を開かなくても、トレイメニューから
> 直接 DND モードを変更できます。VR プレイ中に素早く切り替えたい場合に便利です。

---

## アンインストール

### インストーラー版

1. Windows の **「設定」→「アプリ」→「インストールされているアプリ」** を開く
2. 一覧から **VRNotify** を探す
3. **「アンインストール」** をクリック

以下が自動的に削除されます：
- インストール先フォルダ（`C:\Program Files\VRNotify\`）
- Sparse MSIX パッケージ登録
- スタートメニューのショートカット
- レジストリ登録

### ポータブル版

1. **管理者権限** の PowerShell を開く
2. 展開したフォルダに移動してアンインストールスクリプトを実行:
   ```powershell
   cd "C:\展開先のパス\VRNotify"
   .\uninstall-portable.ps1
   ```
3. VRNotify のフォルダを手動で削除

### ユーザー設定の削除（任意）

アンインストール後も以下のユーザー設定が残ります（再インストール時に設定を引き継ぐため）:

```
%APPDATA%\VRNotify\
├── settings.json    （設定ファイル）
├── history.db       （通知履歴データベース）
└── logs\            （ログファイル）
```

完全に削除したい場合は、以下のフォルダを手動で削除してください:
```
エクスプローラーのアドレスバーに %APPDATA%\VRNotify と入力 → フォルダごと削除
```

> **証明書について**: インストール時に作成された自己署名証明書（CN=VRNotify）は
> アンインストール後もシステムに残ります。実害はありませんが、削除したい場合は
> `certlm.msc` → 「信頼されたユーザー」→「証明書」→「VRNotify」を右クリック → 削除

---

## トラブルシューティング

### 「Package Identity Required」エラーが表示される

VRNotify は Windows 通知を取得するために **Package Identity**（Sparse MSIX）が必要です。

- **インストーラー版**: 再インストールしてください
- **ポータブル版**: `setup-portable.ps1` を管理者権限で実行してください

### 通知が VR に表示されない

以下を順番に確認してください:

1. **SteamVR が起動しているか?**
   - VRNotify は SteamVR と連携して VR 内に表示します
   - SteamVR を起動した後、5秒ほど待ってください
2. **Windows の通知が有効か?**
   - 「設定」→「システム」→「通知」で通知が有効になっているか確認
   - 該当アプリの通知が有効か確認
3. **VRNotify のフィルタ設定を確認**
   - 設定画面 → Filter タブで、該当アプリが「Blocked」になっていないか確認
4. **DND モードを確認**
   - トレイアイコン右クリック → DND Mode が「Off」になっているか確認
5. **VRNotify がトレイに表示されているか?**
   - 青い「VR」アイコンがシステムトレイにあるか確認
   - なければ VRNotify を起動してください

### SteamVR は起動しているのに通知が表示されない

- VRNotify は 5秒間隔で SteamVR を検出します。しばらく待ってみてください
- VRNotify を再起動してみてください
- ログファイル（`%APPDATA%\VRNotify\logs\`）にエラーが記録されている場合があります

### トレイアイコンが見つからない

Windows の通知領域にアイコンが表示されない場合:
- タスクバー右端の **「^」ボタン** をクリックして隠れたアイコンを確認
- 「設定」→「個人用設定」→「タスクバー」→「通知領域」で VRNotify を常時表示に設定

### SmartScreen の警告が表示される

自己署名証明書を使用しているため、Windows SmartScreen が警告を表示することがあります。
**「詳細情報」→「実行」** で続行してください。これは安全性の問題ではなく、
コード署名証明書（有料）を使用していないために表示されるものです。

---

## 既知の制限

- **表示位置**: 現在のバージョンでは HMD 上部（HmdTop）のみ対応
- **通知優先度**: Windows 通知はすべて「低優先度」として扱われます（将来の Discord Bot 連携で改善予定）
- **SteamVR 必須**: スタンドアロン VR（Quest 単体等）では動作しません
- **管理者権限**: 初回インストール/セットアップ時に管理者権限が必要です

---

## データの保存場所

| データ | パス | 内容 |
|--------|------|------|
| 設定 | `%APPDATA%\VRNotify\settings.json` | フィルタ、表示設定、DND モード等 |
| 通知履歴 | `%APPDATA%\VRNotify\history.db` | 過去の通知記録（SQLite） |
| ログ | `%APPDATA%\VRNotify\logs\` | アプリケーションログ |

> すべてのデータはローカルに保存されます。外部サーバーへの送信は一切行いません。

---

## ライセンス

MIT License - 詳細は [LICENSE](LICENSE) を参照
