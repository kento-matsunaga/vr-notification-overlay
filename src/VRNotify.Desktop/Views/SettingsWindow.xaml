<Window x:Class="VRNotify.Desktop.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:VRNotify.Desktop.ViewModels"
        Title="VRNotify 設定"
        Width="520" Height="480"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanMinimize">
    <Window.Resources>
        <Style TargetType="TabItem">
            <Setter Property="Padding" Value="12,6"/>
        </Style>
    </Window.Resources>

    <Grid Margin="8">
        <TabControl>

            <!-- おやすみモード タブ -->
            <TabItem Header="おやすみ">
                <StackPanel Margin="16">
                    <TextBlock Text="おやすみモード（DND）" FontWeight="SemiBold" Margin="0,0,0,8"/>
                    <RadioButton Content="オフ（すべての通知を表示）"
                                 IsChecked="{Binding CurrentDndMode, Converter={StaticResource EnumBoolConverter}, ConverterParameter=Off}"
                                 Margin="0,4"/>
                    <RadioButton Content="すべて非表示"
                                 IsChecked="{Binding CurrentDndMode, Converter={StaticResource EnumBoolConverter}, ConverterParameter=SuppressAll}"
                                 Margin="0,4"/>
                    <RadioButton Content="重要な通知のみ表示"
                                 IsChecked="{Binding CurrentDndMode, Converter={StaticResource EnumBoolConverter}, ConverterParameter=HighPriorityOnly}"
                                 Margin="0,4"/>
                </StackPanel>
            </TabItem>

            <!-- フィルタ タブ -->
            <TabItem Header="フィルタ">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="フィルタモード" FontWeight="SemiBold" Margin="0,0,0,8"/>
                    <StackPanel Grid.Row="1" Margin="0,0,0,12">
                        <RadioButton Content="基本すべて表示（ブロックしたアプリだけ非表示）"
                                     IsChecked="{Binding Filter.IsAllowlistMode, Converter={StaticResource InverseBoolConverter}}"
                                     Margin="0,2"/>
                        <RadioButton Content="基本すべて非表示（許可したアプリだけ表示）"
                                     IsChecked="{Binding Filter.IsAllowlistMode}"
                                     Margin="0,2"/>
                    </StackPanel>

                    <ListView Grid.Row="2" ItemsSource="{Binding Filter.Apps}" Margin="0,0,0,8">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="アプリ名" Width="200"
                                                DisplayMemberBinding="{Binding AppName}"/>
                                <GridViewColumn Header="状態" Width="120">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <ToggleButton Content="{Binding IsAllowed, Converter={StaticResource AllowedTextConverter}}"
                                                          IsChecked="{Binding IsAllowed}"
                                                          Padding="8,2" MinWidth="70"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>

                    <TextBlock Grid.Row="3" Text="※ アプリは通知を受信すると自動でリストに追加されます"
                               FontStyle="Italic" Foreground="Gray" FontSize="11"/>
                </Grid>
            </TabItem>

            <!-- 表示設定 タブ -->
            <TabItem Header="表示">
                <StackPanel Margin="16">
                    <TextBlock Text="表示位置" FontWeight="SemiBold" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding Display.AvailablePositions}"
                              SelectedItem="{Binding Display.Position}"
                              Margin="0,0,0,16" Width="200" HorizontalAlignment="Left"/>

                    <TextBlock Text="表示時間" FontWeight="SemiBold" Margin="0,0,0,4"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <Slider Value="{Binding Display.DisplayDurationSeconds}"
                                Minimum="2" Maximum="15" Width="250"
                                TickFrequency="1" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="{Binding Display.DisplayDurationSeconds, StringFormat='{}{0} 秒'}"
                                   Margin="8,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>

                    <TextBlock Text="不透明度" FontWeight="SemiBold" Margin="0,0,0,4"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <Slider Value="{Binding Display.Opacity}"
                                Minimum="0.1" Maximum="1.0" Width="250"
                                TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="{Binding Display.Opacity, StringFormat='{}{0:P0}'}"
                                   Margin="8,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>

                    <TextBlock Text="大きさ" FontWeight="SemiBold" Margin="0,0,0,4"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <Slider Value="{Binding Display.Scale}"
                                Minimum="0.5" Maximum="2.0" Width="250"
                                TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                        <TextBlock Text="{Binding Display.Scale, StringFormat='{}{0:P0}'}"
                                   Margin="8,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </StackPanel>
            </TabItem>

            <!-- 履歴 タブ -->
            <TabItem Header="履歴">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <ListView Grid.Row="0" ItemsSource="{Binding History.Entries}" Margin="0,0,0,8">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="時刻" Width="60"
                                                DisplayMemberBinding="{Binding TimeDisplay}"/>
                                <GridViewColumn Header="アプリ" Width="80"
                                                DisplayMemberBinding="{Binding AppName}"/>
                                <GridViewColumn Header="送信元" Width="100"
                                                DisplayMemberBinding="{Binding Sender}"/>
                                <GridViewColumn Header="メッセージ" Width="200"
                                                DisplayMemberBinding="{Binding Message}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>

                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right">
                        <TextBlock Text="{Binding History.RetentionDays, StringFormat='保持期間: {0} 日'}"
                                   VerticalAlignment="Center" Margin="0,0,16,0"/>
                        <Button Content="履歴を削除" Command="{Binding History.ClearHistoryCommand}"
                                Padding="12,4"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- 情報 タブ -->
            <TabItem Header="情報">
                <StackPanel Margin="16" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="VRNotify" FontSize="24" FontWeight="Bold"
                               HorizontalAlignment="Center" Margin="0,0,0,8"/>
                    <TextBlock Text="VR 通知オーバーレイ" FontSize="14"
                               HorizontalAlignment="Center" Foreground="Gray" Margin="0,0,0,16"/>
                    <TextBlock Text="v1.0.0" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                    <TextBlock Text="Windows の通知を SteamVR で表示します。"
                               HorizontalAlignment="Center" TextWrapping="Wrap"
                               TextAlignment="Center" Margin="0,0,0,16"/>
                </StackPanel>
            </TabItem>

        </TabControl>
    </Grid>
</Window>
